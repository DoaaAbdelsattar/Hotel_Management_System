<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management - Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-hotel"></i>
                <span>Hotel Management</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/guests"><i class="fas fa-users"></i> Guests</a></li>
                <li><a href="/bookings"><i class="fas fa-calendar-check"></i> Bookings</a></li>
                <li><a href="/rooms"><i class="fas fa-bed"></i> Rooms</a></li>
                <li><a href="/reports" class="active"><i class="fas fa-chart-bar"></i> Reports</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-chart-bar"></i> Reports & Analytics</h1>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="exportReport()">
                    <i class="fas fa-file-export"></i> Export Report
                </button>
                <button class="btn btn-secondary" onclick="printReport()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>

        <!-- Revenue Summary -->
        <div class="section">
            <h2><i class="fas fa-money-bill-wave"></i> Revenue Summary</h2>
            <div class="revenue-summary">
                <div class="revenue-card">
                    <h3>Total Revenue</h3>
                    <div class="revenue-amount">${{ "%.2f"|format(total_revenue) }}</div>
                    <div class="revenue-period">All Time</div>
                </div>
                <div class="revenue-card">
                    <h3>Average Booking Value</h3>
                    <div class="revenue-amount">
                        {% if monthly_stats %}
                            {% set total_rev = total_revenue %}
                            {% set total_bookings = monthly_stats|sum(attribute='NumberOfBookings') %}
                            {% if total_bookings > 0 %}
                                ${{ "%.2f"|format(total_rev / total_bookings) }}
                            {% else %}
                                $0.00
                            {% endif %}
                        {% else %}
                            $0.00
                        {% endif %}
                    </div>
                    <div class="revenue-period">Per Booking</div>
                </div>
                <div class="revenue-card">
                    <h3>Top Performing</h3>
                    <div class="revenue-amount">
                        {% if revenue_by_type %}
                            {{ revenue_by_type[0]['Room_Type'] if revenue_by_type[0] else 'N/A' }}
                        {% else %}
                            N/A
                        {% endif %}
                    </div>
                    <div class="revenue-period">Room Type</div>
                </div>
            </div>
        </div>

        <!-- Revenue by Room Type -->
        <div class="section">
            <h2><i class="fas fa-chart-pie"></i> Revenue by Room Type</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Room Type</th>
                            <th>Total Revenue</th>
                            <th>Percentage</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if revenue_by_type %}
                            {% set grand_total = total_revenue %}
                            {% for revenue in revenue_by_type %}
                            <tr>
                                <td>{{ revenue['Room_Type'] if revenue['Room_Type'] else 'Unknown' }}</td>
                                <td><strong>${{ "%.2f"|format(revenue['Total_Revenue']) }}</strong></td>
                                <td>
                                    {% if grand_total > 0 %}
                                        {{ "%.1f"|format((revenue['Total_Revenue'] / grand_total) * 100) }}%
                                    {% else %}
                                        0%
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {% if grand_total > 0 %}{{ (revenue['Total_Revenue'] / grand_total) * 100 }}{% else %}0{% endif %}%"></div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 20px;">
                                    No revenue data available.
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Monthly Performance -->
        <div class="section">
            <h2><i class="fas fa-calendar-alt"></i> Monthly Performance</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Month</th>
                            <th>Bookings</th>
                            <th>Revenue</th>
                            <th>Avg Revenue/Booking</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if monthly_stats %}
                            {% for month in monthly_stats %}
                            <tr>
                                <td>{{ month['Year'] if month['Year'] else 'N/A' }}</td>
                                <td>
                                    {% if month['Month'] == 1 %}January
                                    {% elif month['Month'] == 2 %}February
                                    {% elif month['Month'] == 3 %}March
                                    {% elif month['Month'] == 4 %}April
                                    {% elif month['Month'] == 5 %}May
                                    {% elif month['Month'] == 6 %}June
                                    {% elif month['Month'] == 7 %}July
                                    {% elif month['Month'] == 8 %}August
                                    {% elif month['Month'] == 9 %}September
                                    {% elif month['Month'] == 10 %}October
                                    {% elif month['Month'] == 11 %}November
                                    {% elif month['Month'] == 12 %}December
                                    {% else %}Unknown
                                    {% endif %}
                                </td>
                                <td>{{ month['NumberOfBookings'] if month['NumberOfBookings'] else 0 }}</td>
                                <td><strong>${{ "%.2f"|format(month['TotalRevenue']) if month['TotalRevenue'] else '0.00' }}</strong></td>
                                <td>
                                    {% if month['NumberOfBookings'] and month['NumberOfBookings'] > 0 %}
                                        ${{ "%.2f"|format(month['TotalRevenue'] / month['NumberOfBookings']) }}
                                    {% else %}
                                        $0.00
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">
                                    No monthly data available.
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Top Guests -->
        <div class="section">
            <h2><i class="fas fa-crown"></i> Top Guests by Revenue</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Guest Name</th>
                            <th>Total Bookings</th>
                            <th>Total Spent</th>
                            <th>Avg Spending/Booking</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if top_guests %}
                            {% for guest in top_guests %}
                            <tr>
                                <td>#{{ loop.index }}</td>
                                <td>{{ guest['GuestName'] if guest['GuestName'] else 'Unknown Guest' }}</td>
                                <td>{{ guest['TotalBookings'] if guest['TotalBookings'] else 0 }}</td>
                                <td><strong>${{ "%.2f"|format(guest['TotalPaid']) }}</strong></td>
                                <td>
                                    {% if guest['TotalBookings'] and guest['TotalBookings'] > 0 %}
                                        ${{ "%.2f"|format(guest['TotalPaid'] / guest['TotalBookings']) }}
                                    {% else %}
                                        $0.00
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">
                                    No guest data available.
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="two-column">
            <div class="section">
                <h2><i class="fas fa-lightbulb"></i> Insights</h2>
                <div class="insights">
                    {% if revenue_by_type and revenue_by_type|length > 0 %}
                        {% set top_type = revenue_by_type[0] %}
                        <div class="insight-item">
                            <i class="fas fa-star" style="color: #FFD700;"></i>
                            <div>
                                <h3>Top Performing Room Type</h3>
                                <p>{{ top_type['Room_Type'] }} generated ${{ "%.2f"|format(top_type['Total_Revenue']) }} in revenue</p>
                            </div>
                        </div>
                    {% endif %}
                    
                    {% if monthly_stats and monthly_stats|length > 0 %}
                        {% set best_month = monthly_stats|max(attribute='TotalRevenue') %}
                        <div class="insight-item">
                            <i class="fas fa-chart-line" style="color: #4CAF50;"></i>
                            <div>
                                <h3>Best Performing Month</h3>
                                <p>{{ best_month['Month'] }}/{{ best_month['Year'] }} had ${{ "%.2f"|format(best_month['TotalRevenue']) }} in revenue</p>
                            </div>
                        </div>
                    {% endif %}
                    
                    {% if top_guests and top_guests|length > 0 %}
                        {% set top_guest = top_guests[0] %}
                        <div class="insight-item">
                            <i class="fas fa-user-tie" style="color: #2196F3;"></i>
                            <div>
                                <h3>Most Valuable Guest</h3>
                                <p>{{ top_guest['GuestName'] }} spent ${{ "%.2f"|format(top_guest['TotalPaid']) }} across {{ top_guest['TotalBookings'] }} bookings</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="section">
                <h2><i class="fas fa-info-circle"></i> Report Information</h2>
                <div class="report-info">
                    <div class="info-item">
                        <i class="fas fa-database"></i>
                        <div>
                            <h3>Data Source</h3>
                            <p>Hotel Management Database</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h3>Last Updated</h3>
                            <p>{{ now.strftime('%Y-%m-%d %H:%M:%S') if now else 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-chart-bar"></i>
                        <div>
                            <h3>Report Coverage</h3>
                            <p>Complete historical data</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Hotel Management System &copy; 2024 | Report Generated: {{ now.strftime('%Y-%m-%d %H:%M:%S') if now else 'N/A' }}</p>
    </footer>

    <script>
        function exportReport() {
            alert('Export report - This would generate a PDF/Excel report.');
        }
        
        function printReport() {
            window.print();
        }
    </script>

    <style>
        .revenue-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 1rem;
        }
        
        .revenue-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid #2196F3;
        }
        
        .revenue-card h3 {
            color: #666;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .revenue-amount {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .revenue-period {
            color: #999;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #21CBF3);
            border-radius: 4px;
        }
        
        .insights {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .insight-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #FF9800;
        }
        
        .insight-item i {
            font-size: 1.5rem;
        }
        
        .insight-item h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .insight-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .report-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .info-item i {
            font-size: 1.5rem;
            color: #4CAF50;
        }
        
        .info-item h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .info-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        @media print {
            .navbar, .page-header, .footer, .action-buttons {
                display: none;
            }
            
            .container {
                margin: 0;
                padding: 0;
            }
            
            .section {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</body>
</html>